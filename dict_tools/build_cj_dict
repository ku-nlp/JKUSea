#!/usr/bin/env bash

# This script takes the translation file—ï (.trans) located in the dict folder 
# and transforms them into a suitable format for the sentence aligner.
# The file dict/dict_zh-ja.tsv has been generated by this script.
# The translation files have been built using a dictionary generation system. 
# For more information:
# http://www.lrec-conf.org/proceedings/lrec2016/pdf/427_Paper.pdf

WORK_DIR=/tmp/dict_zh-ja

if [ -d $WORK_DIR ]; then 
    rm -rf $WORK_DIR
fi
mkdir $WORK_DIR

# Extract zh-ja columns.
for i in ja_dev_500_noun_str.trans ja_test_500_noun_str.trans ; do paste <(cut -f3 ../dict/$i ) <(cut -f2 ../dict/$i ) > $WORK_DIR/${i}_zh-ja.tsv; done
for i in ja_dev_500_nvaa_str.trans ja_test_500_nvaa_str.trans ; do paste <(cut -f3 ../dict/$i ) <(cut -f2 ../dict/$i ) > $WORK_DIR/${i}_zh-ja.tsv; done

# Format (juman + put same keys on one line).
for i in noun nvaa; do ./format_dictionary_CJ.sh $WORK_DIR/ja_dev_500_${i}_str.trans_zh-ja.tsv > $WORK_DIR/ja_dev_${i}_str.trans_zh-ja_formatted.tsv; done
for i in noun nvaa; do ./format_dictionary_CJ.sh $WORK_DIR/ja_test_500_${i}_str.trans_zh-ja.tsv > $WORK_DIR/ja_test_${i}_str.trans_zh-ja_formatted.tsv; done

# Merge files.
./merge-keyvalues-file_oneline.pl < $WORK_DIR/ja_dev_noun_str.trans_zh-ja_formatted.tsv \
    < $WORK_DIR/ja_dev_nvaa_str.trans_zh-ja_formatted.tsv \
    < $WORK_DIR/ja_test_noun_str.trans_zh-ja_formatted.tsv \
    < $WORK_DIR/ja_test_nvaa_str.trans_zh-ja_formatted.tsv > $WORK_DIR/dict_zh-ja.tsv
